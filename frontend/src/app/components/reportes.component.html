<div class="reportes-container">
  <!-- Fondo -->
  <div class="background-pattern"></div>

  <!-- Botones de Navegaci√≥n -->
  <div class="nav-buttons">
    <button class="btn-nav btn-volver" (click)="volverInicio.emit()" title="Volver al Inicio">
      <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" stroke="currentColor" stroke-width="2"/>
        <polyline points="9 22 9 12 15 12 15 22" stroke="currentColor" stroke-width="2"/>
      </svg>
      Inicio
    </button>

    <button class="btn-nav btn-reservas" (click)="irAReservas.emit()" title="Ir a Reservas">
      <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect x="3" y="4" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
        <line x1="16" y1="2" x2="16" y2="6" stroke="currentColor" stroke-width="2"/>
        <line x1="8" y1="2" x2="8" y2="6" stroke="currentColor" stroke-width="2"/>
        <line x1="3" y1="10" x2="21" y2="10" stroke="currentColor" stroke-width="2"/>
      </svg>
      Nueva Reserva
    </button>
  </div>

  <!-- Header -->
  <div class="header">
    <div class="logo-container">
      <svg class="logo-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4zm2.5 2.1h-15V5h15v14.1zm0-16.1h-15c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h15c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z" fill="currentColor"/>
      </svg>
      <h1>Reportes de Ganancias</h1>
    </div>
    <p class="subtitle">Analiza tus ingresos por per√≠odo y tipo de cancha</p>
  </div>

  <!-- Card de Filtros -->
  <div class="filtros-card">
    <h2 class="filtros-title">
      <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="2"/>
        <circle cx="7" cy="6" r="2" fill="currentColor"/>
        <circle cx="17" cy="12" r="2" fill="currentColor"/>
        <circle cx="12" cy="18" r="2" fill="currentColor"/>
      </svg>
      Selecciona el Per√≠odo
    </h2>

    <div class="filtros-form">
      <div class="fecha-group">
        <label for="fechaInicio" class="fecha-label">Desde</label>
        <input
          type="date"
          id="fechaInicio"
          name="fechaInicio"
          [(ngModel)]="fechaInicio"
          class="fecha-input"
        >
      </div>

      <div class="fecha-group">
        <label for="fechaFin" class="fecha-label">Hasta</label>
        <input
          type="date"
          id="fechaFin"
          name="fechaFin"
          [(ngModel)]="fechaFin"
          class="fecha-input"
        >
      </div>

      <button class="btn-generar" (click)="generarReporte()" [disabled]="cargando">
        <svg *ngIf="!cargando" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z" fill="currentColor"/>
        </svg>
        <span *ngIf="cargando" class="spinner"></span>
        {{ cargando ? 'Generando...' : 'Generar Reporte' }}
      </button>

      <button class="btn-limpiar" (click)="limpiarFiltros()">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" fill="currentColor"/>
        </svg>
        Limpiar
      </button>
    </div>

    <!-- Mensaje de error -->
    <div class="error-message" *ngIf="errorMessage">
      <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
        <line x1="12" y1="8" x2="12" y2="12" stroke="currentColor" stroke-width="2"/>
        <line x1="12" y1="16" x2="12.01" y2="16" stroke="currentColor" stroke-width="2"/>
      </svg>
      {{ errorMessage }}
    </div>
  </div>

  <!-- Reporte -->
  <div class="reporte-content" *ngIf="mostrandoReporte && reporte">

    <!-- Resumen General -->
    <div class="resumen-cards">
      <div class="resumen-card total">
        <div class="card-icon">üí∞</div>
        <div class="card-content">
          <div class="card-label">Total Ganancias</div>
          <div class="card-valor">${{ reporte.totalGanancias.toLocaleString('es-CL') }}</div>
          <div class="card-detalle">Pesos Chilenos</div>
        </div>
      </div>

      <div class="resumen-card reservas">
        <div class="card-icon">üìÖ</div>
        <div class="card-content">
          <div class="card-label">Total Reservas</div>
          <div class="card-valor">{{ reporte.totalReservas }}</div>
          <div class="card-detalle">Reservas confirmadas</div>
        </div>
      </div>

      <div class="resumen-card promedio">
        <div class="card-icon">üìä</div>
        <div class="card-content">
          <div class="card-label">Promedio por Reserva</div>
          <div class="card-valor">${{ (reporte.totalGanancias / reporte.totalReservas || 0).toLocaleString('es-CL', {maximumFractionDigits: 0}) }}</div>
          <div class="card-detalle">Ingreso promedio</div>
        </div>
      </div>
    </div>

    <!-- Ganancias por Tipo de Cancha -->
    <div class="seccion-card">
      <h3 class="seccion-title">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
        </svg>
        Ganancias por Tipo de Cancha
      </h3>

      <div class="tipos-grid">
        <div
          *ngFor="let item of tiposCanchaArray"
          class="tipo-card"
          [style.border-left-color]="getColorTipo(item.tipo)"
        >
          <div class="tipo-header">
            <span class="tipo-nombre">{{ item.tipo }}</span>
            <span class="tipo-reservas">{{ item.reservas }} reservas</span>
          </div>
          <div class="tipo-ganancia">${{ item.ganancia.toLocaleString('es-CL') }}</div>
          <div class="tipo-barra">
            <div
              class="tipo-barra-fill"
              [style.width.%]="obtenerPorcentaje(item.ganancia)"
              [style.background-color]="getColorTipo(item.tipo)"
            ></div>
          </div>
          <div class="tipo-porcentaje">{{ obtenerPorcentaje(item.ganancia).toFixed(1) }}% del total</div>
        </div>
      </div>
    </div>

    <!-- Ganancias por M√©todo de Pago -->
    <div class="seccion-card" *ngIf="reporte.gananciaPorPago">
      <h3 class="seccion-title">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="2" y="5" width="20" height="14" rx="2" stroke="currentColor" stroke-width="2"/>
          <path d="M2 10h20" stroke="currentColor" stroke-width="2"/>
        </svg>
        Ganancias por M√©todo de Pago
      </h3>

      <div class="pagos-grid">
        <div *ngFor="let pago of reporte.gananciaPorPago | keyvalue" class="pago-item">
          <div class="pago-tipo">
            <span class="pago-icon">
              <ng-container [ngSwitch]="pago.key">
                <span *ngSwitchCase="'efectivo'">üíµ</span>
                <span *ngSwitchCase="'transferencia'">üè¶</span>
                <span *ngSwitchCase="'debito'">üí≥</span>
                <span *ngSwitchCase="'credito'">üí≥</span>
                <span *ngSwitchCase="'webpay'">üõí</span>
                <span *ngSwitchDefault>üí∞</span>
              </ng-container>
            </span>
            <span class="pago-nombre">{{ pago.key | titlecase }}</span>
          </div>
          <div class="pago-monto">${{ pago.value.toLocaleString('es-CL') }}</div>
        </div>
      </div>
    </div>

    <!-- Tabla de Pagos Detallada -->
    <div class="seccion-card tabla-section">
      <h3 class="seccion-title">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2"/>
        </svg>
        Detalle de Pagos
      </h3>

      <div class="tabla-controles">
        <div class="tabla-info">
          <span class="badge">{{ pagos.length }} pagos encontrados</span>
        </div>
        <div class="tabla-acciones">
          <button class="btn-accion" (click)="imprimirReporte()" title="Imprimir">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zm-3 11H8v-5h8v5zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-1-9H6v4h12V3z" fill="currentColor"/>
            </svg>
          </button>
          <button class="btn-accion" (click)="exportarExcel()" title="Exportar Excel">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm4 18H6V4h7v5h5v11z" fill="currentColor"/>
            </svg>
          </button>
        </div>
      </div>

      <div class="tabla-wrapper">
        <table class="tabla-pagos">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Cliente</th>
              <th>RUT</th>
              <th>Cancha</th>
              <th>Tipo</th>
              <th>Horario</th>
              <th>M√©todo Pago</th>
              <th>Monto</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let pago of pagos" class="tabla-row">
              <td>{{ pago.fecha }}</td>
              <td class="cliente-cell">{{ pago.nombreCliente }}</td>
              <td>{{ pago.rutCliente }}</td>
              <td>{{ pago.nombreCancha }}</td>
              <td>
                <span class="tipo-badge" [class]="'tipo-' + pago.tipoCancha.toLowerCase()">
                  {{ pago.tipoCancha }}
                </span>
              </td>
              <td class="horario-cell">{{ pago.horaInicio }} - {{ pago.horaFin }}</td>
              <td>
                <span class="pago-badge">{{ pago.tipoPago }}</span>
              </td>
              <td class="monto-cell">${{ pago.monto.toLocaleString('es-CL') }}</td>
            </tr>
          </tbody>
          <tfoot>
            <tr class="total-row">
              <td colspan="7" class="total-label">TOTAL</td>
              <td class="total-monto">${{ reporte.totalGanancias.toLocaleString('es-CL') }}</td>
            </tr>
          </tfoot>
        </table>
      </div>

      <div class="tabla-vacia" *ngIf="pagos.length === 0">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z" fill="currentColor"/>
        </svg>
        <p>No hay pagos registrados en este per√≠odo</p>
      </div>
    </div>
  </div>

  <!-- Estado vac√≠o -->
  <div class="estado-vacio" *ngIf="!mostrandoReporte">
    <svg class="icono-vacio" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4zm2.5 2.1h-15V5h15v14.1zm0-16.1h-15c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h15c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z" fill="currentColor"/>
    </svg>
    <h2>Genera tu Primer Reporte</h2>
    <p>Selecciona un rango de fechas y haz clic en "Generar Reporte" para ver tus ganancias</p>
  </div>
</div>

